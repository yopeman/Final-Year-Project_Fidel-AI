enum ReactionType {
  LIKE
  DISLIKE
  LOVE
}


type Notification {
  id: ID!
  userId: ID!
  title: String!
  content: String!
  isRead: Boolean!
  createdAt: DateTime!
  updatedAt: DateTime!
  isDeleted: Boolean!
  deletedAt: DateTime
  # Relationships
  user: User!
}


input TranslateInput {
    text: String!
    dest: String!
    src: String! = "auto"
}

type TranslateResponse {
    src: String!
    dest: String!
    origin: String!
    text: String!
    pronunciation: String!
}

input DetectInput {
    text: String!
}

type DetectResponse {
    lang: String!
    confidence: Float!
}

extend type Query {
    languages: JSON!
    langcodes: JSON!
}

extend type Mutation {
    translate(input: TranslateInput!): TranslateResponse!
    detect(input: DetectInput!): DetectResponse!
    ttsTextNormalization (text: String!): String!
}


input UpdateVideoInput {
  title: String
  thumbnailUrl: String
  description: String
  videoUrl: String
}

type LessonYouTubeVideos {
  id: ID!
  lessonId: ID!
  title: String!
  thumbnailUrl: String
  description: String
  videoUrl: String!
  createdAt: DateTime!
  updatedAt: DateTime!
  isDeleted: Boolean!
  deletedAt: DateTime
  # Relationships
  lesson: ModuleLessons!
}

extend type Query {
  videos(lessonId: ID!): [LessonYouTubeVideos!]!
  video(id: ID!): LessonYouTubeVideos!
}

extend type Mutation {
  updateVideo(id: ID!, input: UpdateVideoInput!): LessonYouTubeVideos!
  deleteVideo(id: ID!): Boolean!
}


enum UserType {
  STUDENT
  TUTOR
}

enum AttendanceStatus {
  PRESENT
  ABSENT
  LATE
}

type Attendance {
  id: ID!
  courseScheduleId: ID!
  userId: ID!
  userType: UserType!
  status: AttendanceStatus!
  attendanceDate: Date!
  createdAt: DateTime!
  updatedAt: DateTime!
  isDeleted: Boolean!
  deletedAt: DateTime
  # Relationships
  courseSchedule: CourseSchedule!
  user: User!
}


type CourseSchedule {
  id: ID!
  scheduleId: ID!
  batchCourseId: ID!
  createdAt: DateTime!
  updatedAt: DateTime!
  isDeleted: Boolean!
  deletedAt: DateTime
  # Relationships
  schedule: Schedule!
  batchCourse: BatchCourse!
  attendances: [Attendance!]!
}


enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
}

type Payment {
  id: ID!
  enrollmentId: ID!
  amount: Float!
  currency: String!
  method: String!
  status: PaymentStatus!
  paidAt: DateTime
  transactionId: String
  receiptUrl: String
  createdAt: DateTime!
  updatedAt: DateTime!
  isDeleted: Boolean!
  deletedAt: DateTime
  # Relationships
  enrollment: BatchEnrollment!
}


type BatchCourse {
  id: ID!
  batchId: ID!
  courseId: ID!
  createdAt: DateTime!
  updatedAt: DateTime!
  isDeleted: Boolean!
  deletedAt: DateTime
  # Relationships
  batch: Batch!
  course: Course!
  schedules: [CourseSchedule!]!
  quizzes: [Quiz!]!
  instructors: [BatchInstructor!]!
}


type CommunityAttachmentFiles {
  id: ID!
  communityId: ID!
  fileName: String!
  filePath: String!
  fileExtension: String!
  createdAt: DateTime!
  updatedAt: DateTime!
  isDeleted: Boolean!
  deletedAt: DateTime
  # Relationships
  community: BatchCommunity!
}


type Feedback {
  id: ID!
  userId: ID
  context: String
  content: String!
  rate: Int!
  createdAt: DateTime!
  updatedAt: DateTime!
  isDeleted: Boolean!
  deletedAt: DateTime
  # Relationships
  user: User
}


enum EnrollmentStatus {
  APPLIED
  ENROLLED
  COMPLETED
  DROPPED
}

type BatchEnrollment {
  id: ID!
  profileId: ID!
  batchId: ID!
  enrollmentDate: Date!
  completionDate: Date
  status: EnrollmentStatus!
  createdAt: DateTime!
  updatedAt: DateTime!
  isDeleted: Boolean!
  deletedAt: DateTime
  # Relationships
  profile: StudentProfile!
  batch: Batch!
  quizResults: [QuizResults!]!
  skillResults: [SkillResult!]!
  payments: [Payment!]!
  certificates: [Certificate!]!
}


type SkillResult {
  id: ID!
  enrollmentId: ID!
  skillId: ID!
  score: Int!
  createdAt: DateTime!
  updatedAt: DateTime!
  isDeleted: Boolean!
  deletedAt: DateTime
  # Relationships
  enrollment: BatchEnrollment!
  skillTest: SkillTests!
}


input UpdateVocabularyInput {
  vocabulary: String
  meaning: String
  description: String
}

type LessonVocabularies {
  id: ID!
  lessonId: ID!
  vocabulary: String!
  meaning: String!
  description: String
  createdAt: DateTime!
  updatedAt: DateTime!
  isDeleted: Boolean!
  deletedAt: DateTime
  # Relationships
  lesson: ModuleLessons!
}

extend type Query {
  vocabularies(lessonId: ID!): [LessonVocabularies!]!
  vocabulary(id: ID!): LessonVocabularies!
}

extend type Mutation {
  updateVocabulary(id: ID!, input: UpdateVocabularyInput!): LessonVocabularies!
  deleteVocabulary(id: ID!): Boolean!
}


enum BatchLevel {
  BEGINNER
  BASIC
  INTERMEDIATE
  ADVANCED
}

enum BatchStatus {
  UPCOMING
  ACTIVE
  COMPLETED
  CANCELLED
}

type Batch {
  id: ID!
  name: String!
  description: String
  level: BatchLevel!
  language: String!
  startDate: Date!
  endDate: Date
  maxStudents: Int!
  status: BatchStatus!
  feeAmount: Float!
  createdAt: DateTime!
  updatedAt: DateTime!
  isDeleted: Boolean!
  deletedAt: DateTime
  # Relationships
  batchCourses: [BatchCourse!]!
  enrollments: [BatchEnrollment!]!
  communities: [BatchCommunity!]!
  instructors: [BatchInstructor!]!
}


type ConversationInteractions {
  id: ID!
  conversationId: ID!
  studentText: String!
  studentAudioUrl: String!
  aiText: String!
  aiAudioUrl: String!
  createdAt: DateTime!
  updatedAt: DateTime!
  isDeleted: Boolean!
  deletedAt: DateTime
  # Relationships
  conversation: FreeConversation!
}

input CreateConversationInteractionInput {
  conversationId: ID!
  text: String
  audioFile: Upload
}

extend type Query {
  conversationInteractions(conversationId: ID!): [ConversationInteractions!]!
  conversationInteraction(id: ID!): ConversationInteractions
}

extend type Mutation {
  talkWithAi(input: CreateConversationInteractionInput!): ConversationInteractions!
  possibleTalk(conversationId: ID!): String!
  deleteConversationInteraction(id: ID!): Boolean!
}


enum SkillTestType {
  READING
  WRITING
  SPEAKING
  LISTENING
}

type SkillTests {
  id: ID!
  evaluatorId: ID!
  type: SkillTestType!
  createdAt: DateTime!
  updatedAt: DateTime!
  isDeleted: Boolean!
  deletedAt: DateTime
  # Relationships
  evaluator: User!
  results: [SkillResult!]!
}


input UpdateLessonInput {
  title: String
  content: String
  displayOrder: Int
  isCompleted: Boolean
  isLocked: Boolean
}

type ModuleLessons {
  id: ID!
  moduleId: ID!
  title: String!
  content: String!
  displayOrder: Int!
  isCompleted: Boolean!
  isLocked: Boolean!
  createdAt: DateTime!
  updatedAt: DateTime!
  isDeleted: Boolean!
  deletedAt: DateTime
  # Relationships
  module: Modules!
  vocabularies: [LessonVocabularies!]!
  onlineArticles: [LessonOnlineArticles!]!
  youtubeVideos: [LessonYouTubeVideos!]!
  interactions: [LessonInteractions!]!
}

type StudentProgress {
  totalModules: Int!
  totalLessons: Int!
  completedLessons: Int!
  remainingLessons: Int!
  progressPercentage: Int!
}

extend type Query {
  lessons(moduleId: ID!): [ModuleLessons!]!
  lesson(id: ID!): ModuleLessons!
  studentProgress(studentId: ID!): StudentProgress!
  myProgress: StudentProgress!
}

extend type Mutation {
  completeLesson(id: ID!): ModuleLessons!
  updateLesson(id: ID!, input: UpdateLessonInput!): ModuleLessons!
  deleteLesson(id: ID!): Boolean!
}


type QuizResults {
  id: ID!
  enrollmentId: ID!
  quizId: ID!
  score: Int!
  createdAt: DateTime!
  updatedAt: DateTime!
  isDeleted: Boolean!
  deletedAt: DateTime
  # Relationships
  enrollment: BatchEnrollment!
  quiz: Quiz!
}


input UpdateModuleInput {
  name: String
  description: String
  displayOrder: Int
  isLocked: Boolean
}

type Modules {
  id: ID!
  profileId: ID!
  name: String!
  description: String
  displayOrder: Int!
  isLocked: Boolean!
  createdAt: DateTime!
  updatedAt: DateTime!
  isDeleted: Boolean!
  deletedAt: DateTime
  # Relationships
  profile: StudentProfile!
  lessons: [ModuleLessons!]!
}

extend type Query {
  modules(profileId: ID!): [Modules!]!
  module(id: ID!): Modules!
}

extend type Mutation {
  updateModule(id: ID!, input: UpdateModuleInput!): Modules!
  deleteModule(id: ID!): Boolean!
}


type CommentReactions {
  id: ID!
  userId: ID!
  commentId: ID!
  reactionType: ReactionType!
  createdAt: DateTime!
  updatedAt: DateTime!
  isDeleted: Boolean!
  deletedAt: DateTime
  # Relationships
  user: User!
  comment: CommunityComment!
}


enum AgeRange {
  UNDER_18
  _18_25
  _26_35
  _36_45
  _45_PLUS
}

enum Proficiency {
  BEGINNER
  BASIC
  INTERMEDIATE
  ADVANCED
}

enum DurationUnit {
  DAYS
  WEEKS
  MONTHS
  YEARS
}

input CreateProfileInput {
  ageRange: AgeRange!
  proficiency: Proficiency!
  nativeLanguage: String!
  learningGoal: String!
  targetDuration: Int!
  durationUnit: DurationUnit!
  constraints: String
}

input UpdateProfileInput {
  ageRange: AgeRange
  proficiency: Proficiency
  nativeLanguage: String
  learningGoal: String
  targetDuration: Int
  durationUnit: DurationUnit
  constraints: String
}

input UpdateLearningPlanInput {
  improvements: String!
}

type StudentProfile {
  id: ID!
  userId: ID!
  ageRange: AgeRange!
  proficiency: Proficiency!
  nativeLanguage: String!
  learningGoal: String!
  targetDuration: Int!
  durationUnit: DurationUnit!
  constraints: String
  aiLearningPlan: String
  createdAt: DateTime!
  updatedAt: DateTime!
  isDeleted: Boolean!
  deletedAt: DateTime
  # Relationships
  user: User!
  modules: [Modules!]!
  freeConversations: [FreeConversation!]!
  batchEnrollments: [BatchEnrollment!]!
}

extend type Query {
  myProfile: StudentProfile
  studentProfile(userId: ID!): StudentProfile!
}

extend type Mutation {
  createProfile(input: CreateProfileInput!): StudentProfile!
  updateProfile(input: UpdateProfileInput!): StudentProfile!
  generateLearningPlan: StudentProfile!
  updateLearningPlan(input: UpdateLearningPlanInput!): StudentProfile!
  installLearningPlan: StudentProfile!
  deletePlan: StudentProfile!
  deleteProfile: Boolean!
}


type Course {
  id: ID!
  name: String!
  description: String
  createdAt: DateTime!
  updatedAt: DateTime!
  isDeleted: Boolean!
  deletedAt: DateTime
  # Relationships
  materials: [CourseMaterial!]!
  batchCourses: [BatchCourse!]!
}


scalar DateTime
scalar Date
scalar Time
scalar JSON
scalar Upload

input PaginationInput {
  page: Int
  limit: Int
}

type Query {
  _: String
}

type Mutation {
  _: String
}

type CourseMaterial {
  id: ID!
  courseId: ID!
  name: String!
  description: String
  createdAt: DateTime!
  updatedAt: DateTime!
  isDeleted: Boolean!
  deletedAt: DateTime
  # Relationships
  course: Course!
  files: [MaterialFiles!]!
}


type Certificate {
  id: ID!
  enrollmentId: ID!
  result: String!
  certificateHtml: String!
  createdAt: DateTime!
  updatedAt: DateTime!
  isDeleted: Boolean!
  deletedAt: DateTime
  # Relationships
  enrollment: BatchEnrollment!
}


type CommunityComment {
  id: ID!
  communityId: ID!
  userId: ID!
  content: String!
  isEdited: Boolean!
  createdAt: DateTime!
  updatedAt: DateTime!
  isDeleted: Boolean!
  deletedAt: DateTime
  # Relationships
  community: BatchCommunity!
  user: User!
  reactions: [CommentReactions!]!
}


type VerificationCode {
  id: ID!
  email: String!
  code: String!
  expiresAt: DateTime!
  isUsed: Boolean!
  userId: ID
  createdAt: DateTime!
  updatedAt: DateTime!
  isDeleted: Boolean!
  deletedAt: DateTime
  # Relationships
  user: User
}


type LessonInteractions {
  id: ID!
  lessonId: ID!
  studentQuestion: String!
  aiAnswer: String!
  createdAt: DateTime!
  updatedAt: DateTime!
  isDeleted: Boolean!
  deletedAt: DateTime
  # Relationships
  lesson: ModuleLessons!
}

input CreateLessonInteractionInput {
  lessonId: ID!
  question: String!
}

extend type Query {
  lessonInteractions(lessonId: ID!): [LessonInteractions!]!
  lessonInteraction(id: ID!): LessonInteractions
}

extend type Mutation {
  createLessonInteraction(input: CreateLessonInteractionInput!): LessonInteractions!
  deleteLessonInteraction(id: ID!): Boolean!
}


type MaterialFiles {
  id: ID!
  materialId: ID!
  fileName: String!
  filePath: String!
  fileExtension: String!
  createdAt: DateTime!
  updatedAt: DateTime!
  isDeleted: Boolean!
  deletedAt: DateTime
  # Relationships
  material: CourseMaterial!
}


type BatchCommunity {
  id: ID!
  batchId: ID!
  userId: ID!
  content: String!
  isEdited: Boolean!
  createdAt: DateTime!
  updatedAt: DateTime!
  isDeleted: Boolean!
  deletedAt: DateTime
  # Relationships
  batch: Batch!
  user: User!
  reactions: [CommunityReactions!]!
  comments: [CommunityComment!]!
  attachments: [CommunityAttachmentFiles!]!
}


type CommunityReactions {
  id: ID!
  userId: ID!
  communityId: ID!
  reactionType: ReactionType!
  createdAt: DateTime!
  updatedAt: DateTime!
  isDeleted: Boolean!
  deletedAt: DateTime
  # Relationships
  user: User!
  community: BatchCommunity!
}


enum UserRole {
  ADMIN
  STUDENT
  TUTOR
  UNDETERMINED
}

enum RegisterUserRole {
  STUDENT
  UNDETERMINED
}

input RegisterInput {
  firstName: String!
  lastName: String!
  email: String!
  password: String!
  role: RegisterUserRole
}

input LoginInput {
  email: String!
  password: String!
}

input UpdateUserInput {
  firstName: String
  lastName: String
  email: String
  password: String
  role: UserRole
  isVerified: Boolean
}

input UpdateMeInput {
  firstName: String
  lastName: String
  email: String
  password: String
}

input VerifyInput {
  email: String!
  verificationCode: String!
}

input PasswordRecoveryInput {
  email: String!
  verificationCode: String!
  newPassword: String!
}

input ResendVerificationInput {
  email: String!
}

input ForgetPasswordInput {
  email: String!
}

type AuthResponse {
  user: User!
  accessToken: String!
  refreshToken: String!
}

type User {
  id: ID!
  firstName: String!
  lastName: String!
  email: String!
  password: String
  role: UserRole!
  isVerified: Boolean!
  accessToken: String
  refreshToken: String
  createdAt: DateTime!
  updatedAt: DateTime!
  isDeleted: Boolean!
  deletedAt: DateTime
  # Relationships
  profile: StudentProfile
  batchInstructors: [BatchInstructor!]!
  batchCommunities: [BatchCommunity!]!
  communityReactions: [CommunityReactions!]!
  communityComments: [CommunityComment!]!
  commentReactions: [CommentReactions!]!
  feedbacks: [Feedback!]!
  notifications: [Notification!]!
  attendances: [Attendance!]!
  verificationCodes: [VerificationCode!]!
}

extend type Query {
  users(pagination: PaginationInput): [User!]!
  user(id: ID!): User!
  me: User!
}

extend type Mutation {
  register(input: RegisterInput!): Boolean!
  verify(input: VerifyInput!): Boolean!
  resendVerification(input: ResendVerificationInput!): Boolean!
  login(input: LoginInput!): AuthResponse!
  logout: Boolean!
  refreshToken: String!
  forgetPassword(input: ForgetPasswordInput!): Boolean!
  passwordRecovery(input: PasswordRecoveryInput!): Boolean!

  updateUser(input: UpdateUserInput!): User!
  updateMe(input: UpdateMeInput!): User!

  deleteUser(id: ID!): Boolean!
  deleteMe: Boolean!
}


type Schedule {
  id: ID!
  dayOfWeek: String!
  startTime: Time!
  endTime: Time!
  createdAt: DateTime!
  updatedAt: DateTime!
  isDeleted: Boolean!
  deletedAt: DateTime
  # Relationships
  courseSchedules: [CourseSchedule!]!
}


enum QuizType {
  MATCHING
  TRUE_FALSE
  FILLING_THE_GAP
}

type Quiz {
  id: ID!
  batchCourseId: ID!
  question: String!
  answer: String!
  type: QuizType!
  createdAt: DateTime!
  updatedAt: DateTime!
  isDeleted: Boolean!
  deletedAt: DateTime
  # Relationships
  batchCourse: BatchCourse!
  results: [QuizResults!]!
}


type FreeConversation {
  id: ID!
  profileId: ID!
  startingTopic: String!
  topicSummaryPhrase: String
  createdAt: DateTime!
  updatedAt: DateTime!
  isDeleted: Boolean!
  deletedAt: DateTime
  # Relationships
  profile: StudentProfile!
  interactions: [ConversationInteractions!]!
}

extend type Query {
  freeConversations(profileId: ID!): [FreeConversation!]!
  freeConversation(id: ID!): FreeConversation
}

extend type Mutation {
  createConversation(startingTopic: String!): FreeConversation!
  generateIdea: String!
  deleteConversation(id: ID!): Boolean!
}


enum InstructorRole {
  MAIN
  ASSISTANT
}

type BatchInstructor {
  id: ID!
  userId: ID!
  batchCourseId: ID!
  role: InstructorRole!
  createdAt: DateTime!
  updatedAt: DateTime!
  isDeleted: Boolean!
  deletedAt: DateTime
  # Relationships
  user: User!
  batchCourse: BatchCourse!
}


input UpdateArticleInput {
  title: String
  faviconUrl: String
  description: String
  pageUrl: String
}

type LessonOnlineArticles {
  id: ID!
  lessonId: ID!
  title: String!
  faviconUrl: String
  description: String
  pageUrl: String!
  createdAt: DateTime!
  updatedAt: DateTime!
  isDeleted: Boolean!
  deletedAt: DateTime
  # Relationships
  lesson: ModuleLessons!
}

extend type Query {
  articles(lessonId: ID!): [LessonOnlineArticles!]!
  article(id: ID!): LessonOnlineArticles!
}

extend type Mutation {
  updateArticle(id: ID!, input: UpdateArticleInput!): LessonOnlineArticles!
  deleteArticle(id: ID!): Boolean!
}
